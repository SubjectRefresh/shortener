<!DOCTYPE html>
<html>

<head>
    <title>Shortener | Made by SubjectRefresh</title>
    <link rel="stylesheet" type="text/css" href="css/shortener.css" />
</head>

<body>
    <form>
        <div class="input-field full">
            <label for="url">Long URL</label>
            <input type="text" id="url" onClick="this.select();" autocomplete="off">
        </div><span class="title"><span id="count">0</span> New shortlinks</span>
    </form>
    <script src="//cdn.socket.io/socket.io-1.2.0.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <script>
    $('input').focus(function() {
        var label = $("[for='" + $(this).attr('id') + "']")
        label.addClass('raised highlight')
    })
    $('input').blur(function() {
        var label = $("[for='" + $(this).attr('id') + "']")
        label.removeClass('highlight')
        if ($(this).val().length == 0) {
            label.removeClass('raised')
        }
    })


    $(function() {
        var count = 0;
        var socket = io();
        var url;
        $("form").on("submit", function() {
            url = $("#url").val();
            generateShortlink(url);
            return false;
        });

        $("#url").on("paste", function() {
            var element = this;
            setTimeout(function() { // otherwise the value is blank
                generateShortlink($(element).val());
            }, 0);
        });
        socket.on("increment count", function() {
            count++;
            $("#count").html(count);
        });

        function generateShortlink(url) {
            socket.emit("url", url, function(packet) {
                if (packet.status) {
                    $("#count").html(count);
                    $("#url").fadeOut("fast", function() {
                        $("#url").val(packet.shortlink).fadeIn("fast").click();
                    });
                } else {
                    $("form").effect("shake");
                }
            });
        }
    });
    // (function(i, s, o, g, r, a, m) {
    //     i['GoogleAnalyticsObject'] = r;
    //     i[r] = i[r] || function() {
    //         (i[r].q = i[r].q || []).push(arguments)
    //     }, i[r].l = 1 * new Date();
    //     a = s.createElement(o),
    //         m = s.getElementsByTagName(o)[0];
    //     a.async = 1;
    //     a.src = g;
    //     m.parentNode.insertBefore(a, m)
    // })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    // ga('create', 'UA-69122586-2', 'auto');
    // ga('send', 'pageview');
    </script>
</body>

</html>
